<!doctype html>
<html lang=\"en\">
<head>
  <meta charset=\"UTF-8\" />
  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\" />
  <title>Bootah v8 · Boot smarter. Deploy faster.</title>
  <script src=\"https://cdn.tailwindcss.com\"></script>
  <script crossorigin src=\"https://unpkg.com/react@18/umd/react.production.min.js\"></script>
  <script crossorigin src=\"https://unpkg.com/react-dom@18/umd/react-dom.production.min.js\"></script>
</head>
<body class=\"bg-[#081c29] text-white min-h-screen\">
  <div id=\"root\"></div>

  <script type=\"text/javascript\">
    function App() {
      const [images, setImages] = React.useState([]);
      const [token, setToken] = React.useState(localStorage.getItem('bootah_token')||'');
      const [role, setRole] = React.useState(localStorage.getItem('bootah_role')||'');
      const [email, setEmail] = React.useState('');
      const [password, setPassword] = React.useState('');

      function authedFetch(url, opts={}){
        const headers = Object.assign({}, opts.headers||{});
        if(token){ headers['Authorization'] = 'Bearer ' + token; }
        return fetch(url, Object.assign({}, opts, {headers}));
      }
      function login(e){
        e.preventDefault();
        fetch('/api/auth/login',{method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({email, password})})
          .then(r=> r.ok ? r.json() : Promise.reject('Login failed'))
          .then(x=>{
            localStorage.setItem('bootah_token', x.token); setToken(x.token);
            return fetch('/api/auth/me',{headers:{Authorization:'Bearer '+x.token}});
          })
          .then(r=>r.json())
          .then(me=>{ localStorage.setItem('bootah_role', me.role||''); setRole(me.role||''); alert('Logged in'); })
          .catch(err=> alert(err));
      }
      function logout(){ fetch('/api/auth/logout',{method:'POST'}).finally(()=>{ localStorage.removeItem('bootah_token'); localStorage.removeItem('bootah_role'); setToken(''); setRole(''); }); }
      function startOIDC(){ fetch('/api/auth/oidc/start').then(r=>r.json()).then(x=>{ if(x.redirect){ window.location.href = x.redirect; } else { alert('SSO not configured'); } }); }

      React.useEffect(() => {
        // silent refresh
        fetch('/api/auth/refresh', {method:'POST'}).then(r=> r.ok ? r.json() : null).then(x=>{ if(x && x.token){ localStorage.setItem('bootah_token', x.token); setToken(x.token); } });
        authedFetch('/api/v1/images').then(r => r.json()).then(setImages).catch(()=>{});
      }, [token]);

      return React.createElement('div', {className: 'px-6 md:px-16 py-10'}, [
        React.createElement('header', {key:'h', className:'flex items-center justify-between'}, [
          React.createElement('div', {key:'brand', className:'flex items-center gap-3'}, [
            React.createElement('div', {key:'logo', className:'w-10 h-10 rounded-full bg-cyan-500'}),
            React.createElement('h1', {key:'ttl', className:'text-2xl font-extrabold text-cyan-400'}, 'Bootah v8')
          ]),
          token 
          ? React.createElement('div',{key:'acct',className:'flex items-center gap-2'},[
              React.createElement('span',{key:'rl',className:'text-sm text-gray-300'}, 'Role: '+(role||'n/a')),
              React.createElement('button',{onClick:logout, className:'px-4 py-2 bg-cyan-500 text-black rounded-2xl font-semibold'},'Logout')
            ])
          : React.createElement('div',{key:'auth',className:'flex items-center gap-2'},[
              React.createElement('form',{onSubmit:login, className:'flex items-center gap-2'},[
                React.createElement('input',{placeholder:'email', value:email, onChange:e=>setEmail(e.target.value), className:'px-2 py-1 rounded bg-[#0d2538] text-sm'}),
                React.createElement('input',{type:'password', placeholder:'password', value:password, onChange:e=>setPassword(e.target.value), className:'px-2 py-1 rounded bg-[#0d2538] text-sm'}),
                React.createElement('button',{type:'submit', className:'px-3 py-2 bg-cyan-500 text-black rounded-2xl font-semibold'},'Login')
              ]),
              React.createElement('button',{onClick:startOIDC,className:'px-3 py-2 border border-cyan-500 rounded-2xl hover:bg-cyan-900'},'Login with SSO')
            ])
        ]),
        React.createElement('section', {key:'hero', className:'text-center py-10'}, [
          React.createElement('h2', {key:'tg', className:'text-4xl md:text-6xl font-extrabold mb-4'}, 'Boot smarter. Deploy faster.'),
          React.createElement('p', {key:'sub', className:'text-gray-300 max-w-3xl mx-auto'}, 'A modern PXE + OS imaging platform with web UI, APIs, and cloud integration.')
        ]),
        token && React.createElement('section',{key:'changepw',className:'mt-6 bg-[#0a202f] rounded-2xl p-6'},(function(){ 
            const [curr,setCurr]=React.useState(''); const [nw,setNew]=React.useState('');
            function submit(e){ e.preventDefault(); authedFetch('/api/auth/change_password',{method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({current:curr, new:nw})}).then(r=>{ if(r.ok){ alert('Password changed'); setCurr(''); setNew(''); } else { r.text().then(t=>alert('Error: '+t)); } }); }
            return React.createElement('form',{onSubmit:submit,className:'flex flex-col md:flex-row gap-3 items-start'},[
              React.createElement('input',{value:curr,onChange:e=>setCurr(e.target.value),type:'password',placeholder:'Current password',className:'px-3 py-2 rounded-lg bg-[#081c29] border border-cyan-900/40 text-sm w-full md:w-64'}),
              React.createElement('input',{value:nw,onChange:e=>setNew(e.target.value),type:'password',placeholder:'New password',className:'px-3 py-2 rounded-lg bg-[#081c29] border border-cyan-900/40 text-sm w-full md:w-64'}),
              React.createElement('button',{type:'submit',className:'px-4 py-2 bg-cyan-500 text-black rounded-2xl font-semibold'},'Change Password')
            ]);
        })()),
        role==='admin' && React.createElement('section',{key:'upload',className:'mt-12 bg-[#0a202f] rounded-2xl p-6'},[
          React.createElement('h3',{key:'tt',className:'text-xl font-bold text-cyan-300 mb-3'},'Upload Image'),
          (function(){ 
            let nameRef = React.useRef(); let fileRef = React.useRef();
            function onSubmit(e){
              e.preventDefault();
              const fd = new FormData();
              if(nameRef.current && nameRef.current.value){ fd.append('name', nameRef.current.value); }
              if(fileRef.current && fileRef.current.files[0]){ fd.append('file', fileRef.current.files[0]); } else { return; }
              authedFetch('/api/v1/images',{method:'POST', body: fd}).then(r=>r.json()).then(x=>{
                setImages(prev=>[x, ...prev]); nameRef.current.value=''; fileRef.current.value='';
              });
            }
            return React.createElement('form',{onSubmit:onSubmit,className:'flex flex-col md:flex-row gap-3 items-start'},[
              React.createElement('input',{ref:nameRef, placeholder:'Friendly name (optional)', className:'px-3 py-2 rounded-lg bg-[#081c29] border border-cyan-900/40 text-sm w-full md:w-72'}),
              React.createElement('input',{ref:fileRef, type:'file', accept:'.wim,.ffu,.iso', className:'text-sm'}),
              React.createElement('button',{type:'submit', className:'px-4 py-2 bg-cyan-500 text-black rounded-2xl font-semibold'},'Upload')
            ]);
          })()
        ]),
        React.createElement('section',{key:'imgs',className:'mt-12'},[
          React.createElement('h3',{key:'hh',className:'text-xl font-bold text-cyan-300 mb-2'},'Images'),
          React.createElement('div',{key:'grid',className:'grid md:grid-cols-3 gap-4'}, images.map(x => 
            React.createElement('div',{key:x.id,className:'bg-[#081c29] border border-cyan-900/40 rounded-xl p-4 space-y-2'},[
              React.createElement('div',{key:'n',className:'font-semibold'},x.name),
              React.createElement('div',{key:'m',className:'text-sm text-gray-400'},x.type.toUpperCase()+ ' • ' + x.sizeMB + ' MB'),
              React.createElement('div',{key:'u',className:'text-xs text-gray-500 mt-1'},'Updated '+x.updated),
              React.createElement('div',{key:'btns',className:'flex gap-2 pt-2'},[
                React.createElement('a',{href:'/api/v1/images/'+x.id+'/download', className:'text-sm underline'},'Download'),
                role==='admin' ? React.createElement('button',{onClick:()=>{
                  authedFetch('/api/v1/images/'+x.id,{method:'DELETE'}).then(()=>setImages(prev=>prev.filter(i=>i.id!==x.id)))
                }, className:'text-sm underline text-red-400'},'Delete') : null
              ]),
            ])
          ))
        ]),
        role==='admin' && React.createElement('section',{key:'admin-users',className:'mt-12 bg-[#0a202f] rounded-2xl p-6'},[
          React.createElement('h3',{key:'t',className:'text-xl font-bold text-cyan-300 mb-3'},'Admin: User Management'),
          (function(){
            const [users, setUsers] = React.useState([]);
            React.useEffect(()=>{ authedFetch('/api/admin/users').then(r=>r.json()).then(setUsers); }, [token]);
            function changeRole(id, role){
              authedFetch('/api/admin/users/role',{method:'PUT', headers:{'Content-Type':'application/json'}, body: JSON.stringify({id, role})})
                .then(()=> authedFetch('/api/admin/users').then(r=>r.json()).then(setUsers));
            }
            function delUser(id){
              if(!confirm('Delete user '+id+'?')) return;
              authedFetch('/api/admin/users/delete',{method:'DELETE', headers:{'Content-Type':'application/json'}, body: JSON.stringify({id})})
                .then(()=> authedFetch('/api/admin/users').then(r=>r.json()).then(setUsers));
            }
            function resetPw(id,email){
              authedFetch('/api/admin/users/reset_password',{method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({id})})
                .then(r=>r.json()).then(x=> alert('Temporary password for '+email+': '+x.temporaryPassword));
            }
            return React.createElement('div',{className:'overflow-x-auto'},[
              React.createElement('table',{className:'w-full text-sm'},[
                React.createElement('thead',{key:'h'},[React.createElement('tr',{},[
                  React.createElement('th',{className:'text-left p-2 text-gray-400'},'ID'),
                  React.createElement('th',{className:'text-left p-2 text-gray-400'},'Email'),
                  React.createElement('th',{className:'text-left p-2 text-gray-400'},'Role'),
                  React.createElement('th',{className:'text-left p-2 text-gray-400'},'Created'),
                  React.createElement('th',{className:'text-left p-2 text-gray-400'},'Actions'),
                ])]),
                React.createElement('tbody',{key:'b'}, users.map(u=> React.createElement('tr',{key:u.id,className:'border-t border-cyan-900/40'},[
                  React.createElement('td',{className:'p-2'}, String(u.id)),
                  React.createElement('td',{className:'p-2'}, u.email),
                  React.createElement('td',{className:'p-2'}, u.role),
                  React.createElement('td',{className:'p-2 text-gray-400'}, u.created_at || ''),
                  React.createElement('td',{className:'p-2'}, [
                    React.createElement('select',{key:'sel', defaultValue:u.role, className:'bg-[#081c29] border border-cyan-900/40 rounded px-2 py-1 mr-2', onChange:e=>changeRole(u.id, e.target.value)},[
                      React.createElement('option',{value:'admin'},'admin'),
                      React.createElement('option',{value:'operator'},'operator'),
                      React.createElement('option',{value:'viewer'},'viewer'),
                    ]),
                    React.createElement('button',{key:'rst', onClick:()=>resetPw(u.id,u.email), className:'px-3 py-1 bg-yellow-500/80 hover:bg-yellow-500 text-black rounded-lg mr-2'},'Reset PW'),
                    React.createElement('button',{key:'del', onClick:()=>delUser(u.id), className:'px-3 py-1 bg-red-500/80 hover:bg-red-500 text-white rounded-lg'},'Delete')
                  ]),
                ])))
              ])
            ]);
          })()
        ]),
        role==='admin' && React.createElement('section',{key:'audit',className:'mt-12 bg-[#0a202f] rounded-2xl p-6'},[
          React.createElement('h3',{className:'text-xl font-bold text-cyan-300 mb-3'},'Admin: Audit Trail'),
          (function(){
            const [rows,setRows] = React.useState([]);
            React.useEffect(()=>{ authedFetch('/api/admin/audit').then(r=>r.json()).then(setRows); }, [token]);
            return React.createElement('div',{className:'overflow-x-auto'},[
              React.createElement('table',{className:'w-full text-sm'},[
                React.createElement('thead',{},[React.createElement('tr',{},[
                  React.createElement('th',{className:'p-2 text-left text-gray-400'},'Time'),
                  React.createElement('th',{className:'p-2 text-left text-gray-400'},'Actor'),
                  React.createElement('th',{className:'p-2 text-left text-gray-400'},'Action'),
                  React.createElement('th',{className:'p-2 text-left text-gray-400'},'Resource'),
                  React.createElement('th',{className:'p-2 text-left text-gray-400'},'Meta'),
                ])]),
                React.createElement('tbody',{}, rows.map((r,i)=> React.createElement('tr',{key:i,className:'border-t border-cyan-900/40'},[
                  React.createElement('td',{className:'p-2'}, r.ts),
                  React.createElement('td',{className:'p-2'}, String(r.actor_id||'')),
                  React.createElement('td',{className:'p-2'}, r.action),
                  React.createElement('td',{className:'p-2'}, r.resource),
                  React.createElement('td',{className:'p-2 text-gray-400'}, r.meta),
                ])))
              ])
            ]);
          })()
        ]),
        role==='admin' && React.createElement('section',{key:'storage',className:'mt-12 bg-[#0a202f] rounded-2xl p-6'},[
          React.createElement('h3',{className:'text-xl font-bold text-cyan-300 mb-3'},'Admin: Storage Health'),
          (function(){
            const [info,setInfo] = React.useState(null);
            React.useEffect(()=>{ authedFetch('/api/admin/storage/health').then(r=>r.json()).then(setInfo); }, [token]);
            return info ? React.createElement('div',{},[
              React.createElement('div',{}, 'Mode: ' + info.mode),
              info.bucket ? React.createElement('div',{}, 'Bucket: ' + info.bucket) : null,
              info.region ? React.createElement('div',{}, 'Region: ' + info.region) : null,
              React.createElement('div',{className: (info.ok?'text-green-400':'text-red-400')}, 'Status: ' + (info.ok?'OK':'Error: '+(info.error||''))),
              React.createElement('p',{className:'text-xs text-gray-400 mt-2'}, 'SSE toggles are env-driven for now.')
            ]) : React.createElement('div',{},'Loading...');
          })()
        ]),
        role==='admin' && React.createElement('section',{key:'winpe',className:'mt-12 bg-[#0a202f] rounded-2xl p-6'},[
          React.createElement('h3',{className:'text-xl font-bold text-cyan-300 mb-3'},'Admin: WinPE Builder (stub)'),
          (function(){
            const [jobs,setJobs] = React.useState([]);
            function refresh(){ authedFetch('/api/admin/winpe/jobs').then(r=>r.json()).then(setJobs); }
            React.useEffect(()=>{ refresh(); }, [token]);
            function build(){ authedFetch('/api/admin/winpe/jobs',{method:'POST'}).then(()=>refresh()); }
            return React.createElement('div',{},[
              React.createElement('button',{onClick:build,className:'px-4 py-2 bg-cyan-500 text-black rounded-2xl font-semibold mb-3'},'Create WinPE Build Job'),
              React.createElement('ul',{className:'space-y-2'}, jobs.map(j=> React.createElement('li',{key:j.id,className:'bg-[#081c29] border border-cyan-900/40 rounded-xl p-3'}, j.id + ' • ' + j.status + (j.result?(' • '+j.result):''))))
            ]);
          })()
        ]),
        role==='admin' && React.createElement('section',{key:'drivers',className:'mt-12 bg-[#0a202f] rounded-2xl p-6'},[
          React.createElement('h3',{className:'text-xl font-bold text-cyan-300 mb-3'},'Admin: Driver Packs'),
          (function(){
            const [packs,setPacks] = React.useState([]);
            const [form,setForm] = React.useState({vendor:'',model:'',version:'',url:'',checksum:'',notes:''});
            function load(){ authedFetch('/api/admin/driver_packs').then(r=>r.json()).then(setPacks); }
            React.useEffect(()=>{ load(); }, [token]);
            function add(e){ e.preventDefault(); authedFetch('/api/admin/driver_packs',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(form)}).then(()=>{ setForm({vendor:'',model:'',version:'',url:'',checksum:'',notes:''}); load(); }); }
            function del(id){ if(!confirm('Delete pack?')) return; authedFetch('/api/admin/driver_packs',{method:'DELETE',headers:{'Content-Type':'application/json'},body:JSON.stringify({id})}).then(load); }
            return React.createElement('div',{},[
              React.createElement('form',{onSubmit:add,className:'grid md:grid-cols-3 gap-3 mb-4'},[
                React.createElement('input',{placeholder:'Vendor',value:form.vendor,onChange:e=>setForm({...form,vendor:e.target.value}),className:'px-3 py-2 rounded-lg bg-[#081c29] border border-cyan-900/40 text-sm'}),
                React.createElement('input',{placeholder:'Model',value:form.model,onChange:e=>setForm({...form,model:e.target.value}),className:'px-3 py-2 rounded-lg bg-[#081c29] border border-cyan-900/40 text-sm'}),
                React.createElement('input',{placeholder:'Version',value:form.version,onChange:e=>setForm({...form,version:e.target.value}),className:'px-3 py-2 rounded-lg bg-[#081c29] border border-cyan-900/40 text-sm'}),
                React.createElement('input',{placeholder:'URL',value:form.url,onChange:e=>setForm({...form,url:e.target.value}),className:'px-3 py-2 rounded-lg bg-[#081c29] border border-cyan-900/40 text-sm md:col-span-2'}),
                React.createElement('input',{placeholder:'Checksum',value:form.checksum,onChange:e=>setForm({...form,checksum:e.target.value}),className:'px-3 py-2 rounded-lg bg-[#081c29] border border-cyan-900/40 text-sm'}),
                React.createElement('input',{placeholder:'Notes',value:form.notes,onChange:e=>setForm({...form,notes:e.target.value}),className:'px-3 py-2 rounded-lg bg-[#081c29] border border-cyan-900/40 text-sm md:col-span-2'}),
                React.createElement('button',{type:'submit',className:'px-4 py-2 bg-cyan-500 text-black rounded-2xl font-semibold'},'Add Pack')
              ]),
              React.createElement('div',{className:'grid md:grid-cols-2 gap-3'}, packs.map(p=> React.createElement('div',{key:p.id,className:'bg-[#081c29] border border-cyan-900/40 rounded-xl p-4'},[
                React.createElement('div',{}, p.vendor + ' ' + p.model + ' (' + p.version + ')'),
                React.createElement('div',{className:'text-xs text-gray-400 break-all'}, p.url),
                React.createElement('div',{className:'text-xs text-gray-400'}, 'Checksum: ' + (p.checksum||'')),
                React.createElement('div',{className:'text-xs text-gray-400'}, p.notes||''),
                React.createElement('div',{className:'pt-2'}, React.createElement('button',{onClick:()=>del(p.id),className:'text-sm underline text-red-400'},'Delete'))
              ])))
            ]);
          })()
        ]),
        React.createElement('footer', {key:'f', className:'text-center text-gray-500 text-sm mt-14'}, '© ' + new Date().getFullYear() + ' Bootah')
      ]);
    }
    ReactDOM.createRoot(document.getElementById('root')).render(React.createElement(App));
  </script>
</body>
</html>
